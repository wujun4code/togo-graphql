//
// Autogenerated by `prisma-import`
// Any modifications will be overwritten on subsequent runs.
//

//
// client.prisma
//

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// post.prisma
//

model Post {
  id        Int     @id @default(autoincrement())
  title     String
  content   String?
  published Boolean @default(false)
  authorId  Int
  author    User    @relation(fields: [authorId], references: [id])
}

//
// travel-plan.prisma
//

model TravelPlan {
  id            Int           @id @default(autoincrement())
  content       String?
  published     Boolean       @default(false)
  creatorId     Int
  creator       User          @relation(fields: [creatorId], references: [id])
  originId      Int
  origin        LocationPoint @relation("OriginLocationPoint", fields: [originId], references: [id])
  destinationId Int
  destination   LocationPoint @relation("DestinationLocationPoint", fields: [destinationId], references: [id])

  aclRules TravelPlanACLRule[]

  aclUserRules          TravelPlanUserACLRule[]
  TravelPlanRoleACLRule TravelPlanRoleACLRule[]
}

model LocationPoint {
  id             Int          @id @default(autoincrement())
  lat            Float
  lon            Float
  onOrigins      TravelPlan[] @relation("OriginLocationPoint")
  onDestinations TravelPlan[] @relation("DestinationLocationPoint")

  @@unique([lat, lon], name: "unique_lat_lon_constraint")
}

model TravelPlanUserACLRule {
  id     Int @id @default(autoincrement())
  userId Int

  user User? @relation(fields: [userId], references: [id])

  readPermission  Boolean
  writePermission Boolean

  travelPlanId Int
  travelPlan   TravelPlan @relation(fields: [travelPlanId], references: [id])

  @@unique([userId, travelPlanId], name: "unique_user_travelPlan_constraint")
}

model TravelPlanRoleACLRule {
  id     Int @id @default(autoincrement())
  roleId Int

  role Role @relation(fields: [roleId], references: [id])

  readPermission  Boolean
  writePermission Boolean

  travelPlanId Int
  travelPlan   TravelPlan @relation(fields: [travelPlanId], references: [id])

  @@unique([roleId, travelPlanId], name: "unique_role_travelPlan_constraint")
}

model TravelPlanACLRule {
  id       Int     @id @default(autoincrement())
  wildcard String?

  roleId Int?
  userId Int?

  role Role? @relation(fields: [roleId], references: [id])
  user User? @relation(fields: [userId], references: [id])

  readPermission  Boolean
  writePermission Boolean

  travelPlanId Int?
  travelPlan   TravelPlan? @relation(fields: [travelPlanId], references: [id])
}

//
// user-role.prisma
//

model Role {
  id                    Int                     @id @default(autoincrement())
  name                  String                  @unique
  description           String
  users                 RoleUser[]
  TravelPlanACLRule     TravelPlanACLRule[]
  TravelPlanRoleACLRule TravelPlanRoleACLRule[]
}

model User {
  id                    Int                     @id @default(autoincrement())
  email                 String                  @unique
  name                  String?
  sub                   String                  @unique
  posts                 Post[]
  travelPlans           TravelPlan[]
  roles                 RoleUser[]
  TravelPlanACLRule     TravelPlanACLRule[]
  TravelPlanUserACLRule TravelPlanUserACLRule[]
}

model RoleUser {
  id     Int  @id @default(autoincrement())
  roleId Int
  userId Int
  user   User @relation(fields: [userId], references: [id])
  role   Role @relation(fields: [roleId], references: [id])

  @@index([roleId, userId], name: "unique_user_role")
}

//
// webhook.prisma
//

model WebHook {
  id      Int             @id @default(autoincrement())
  name    String          @unique
  url     String
  headers WebHookHeader[]
  events  WebHookEvent[]
}

model WebHookHeader {
  id        Int     @id @default(autoincrement())
  webHook   WebHook @relation(fields: [webHookId], references: [id])
  webHookId Int
  key       String
  value     String
}

model WebHookEvent {
  id        Int     @id @default(autoincrement())
  webHook   WebHook @relation(fields: [webHookId], references: [id])
  webHookId Int
  resource  String
  operation String
}
